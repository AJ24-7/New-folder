<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- ═══════════════════════════════════════════════════════════
         LOCATION PERMISSIONS (required for geofence attendance)
    ═══════════════════════════════════════════════════════════════ -->
    <!-- Standard location (foreground) -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

    <!-- Background location — mandatory for auto-attendance during gym hours
         Android 10+ (API 29+): user must explicitly grant "Allow all the time" -->
    <uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" />

    <!-- ═══════════════════════════════════════════════════════════
         BACKGROUND SERVICE PERMISSIONS
    ═══════════════════════════════════════════════════════════════ -->
    <!-- Activity Recognition — improves geofence accuracy & reduces battery drain -->
    <uses-permission android:name="android.permission.ACTIVITY_RECOGNITION" />

    <!-- Android 12+ (API 31+): explicit activity recognition for step/motion detection -->
    <uses-permission android:name="com.google.android.gms.permission.ACTIVITY_RECOGNITION" />

    <!-- Wake Lock — keeps CPU alive while geofence service is running -->
    <uses-permission android:name="android.permission.WAKE_LOCK" />

    <!-- Foreground Service — required to run background location service visibly -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_LOCATION" />

    <!-- Restart service after device reboot (persists geofence across reboots) -->
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />

    <!-- Schedule exact alarms for operating-hours attendance window checks -->
    <uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" />
    <uses-permission android:name="android.permission.USE_EXACT_ALARM" />

    <!-- ═══════════════════════════════════════════════════════════
         NOTIFICATION PERMISSIONS
    ═══════════════════════════════════════════════════════════════ -->
    <!-- Android 13+ (API 33+): must request POST_NOTIFICATIONS at runtime -->
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>

    <!-- ═══════════════════════════════════════════════════════════
         NETWORK / STORAGE PERMISSIONS
    ═══════════════════════════════════════════════════════════════ -->
    <uses-permission android:name="android.permission.INTERNET"/>
    
    <!-- Camera and Storage Permissions for Profile Image Upload -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" 
                     android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"
                     android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
    
    <uses-feature android:name="android.hardware.camera" android:required="false" />
    <uses-feature android:name="android.hardware.camera.autofocus" android:required="false" />
    
    <application
        android:label="gym_wale_app"
        android:name="${applicationName}"
        android:icon="@mipmap/ic_launcher"
        android:networkSecurityConfig="@xml/network_security_config"
        android:usesCleartextTraffic="true">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:taskAffinity=""
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            <!-- Specifies an Android theme to apply to this Activity as soon as
                 the Android process has started. This theme is visible to the user
                 while the Flutter UI initializes. After that, this theme continues
                 to determine the Window background behind the Flutter UI. -->
            <meta-data
              android:name="io.flutter.embedding.android.NormalTheme"
              android:resource="@style/NormalTheme"
              />
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
        </activity>
        
        <!-- ─────────────────────────────────────────────────────────
             GEOFENCE BACKGROUND SERVICE (geofence_service package)
             Uses the service registered by the geofence_service pub package.
             foregroundServiceType="location" keeps it alive while tracking.
        ──────────────────────────────────────────────────────────── -->
        <service
            android:name="com.pravera.geofence_service.GeofenceService"
            android:exported="false"
            android:foregroundServiceType="location" />

        <!-- ─────────────────────────────────────────────────────────
             FLUTTER FOREGROUND TASK — killed-app persistent service
             stopWithTask="false" ensures the service SURVIVES app
             force-kill (swipe from recents).  autoStart="true" means
             the OS restarts it after being killed by resource pressure.
             foregroundServiceType="location" grants GPS in background.
        ──────────────────────────────────────────────────────────── -->
        <service
            android:name="com.pravera.flutter_foreground_task.service.ForegroundService"
            android:foregroundServiceType="location"
            android:stopWithTask="false"
            android:exported="false" />

        <!-- ─────────────────────────────────────────────────────────
             BOOT RECEIVER — re-registers geofences after device reboot
        ──────────────────────────────────────────────────────────── -->
        <receiver
            android:name="com.pravera.geofence_service.BootReceiver"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED" />
                <action android:name="android.intent.action.MY_PACKAGE_REPLACED" />
            </intent-filter>
        </receiver>

        <!-- ─────────────────────────────────────────────────────────
             FLUTTER LOCAL NOTIFICATIONS — attendance pop-up channel
        ──────────────────────────────────────────────────────────── -->
        <receiver
            android:exported="false"
            android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationReceiver" />
        <receiver
            android:exported="false"
            android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationBootReceiver">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED"/>
                <action android:name="android.intent.action.MY_PACKAGE_REPLACED"/>
                <action android:name="android.intent.action.QUICKBOOT_POWERON"/>
            </intent-filter>
        </receiver>
            
        <!-- Don't delete the meta-data below.
             This is used by the Flutter tool to generate GeneratedPluginRegistrant.java -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
            
        <!-- Firebase Cloud Messaging -->
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_channel_id"
            android:value="gym_wale_attendance" />
            
        <!-- Notification Icon (default launcher icon) -->
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_icon"
            android:resource="@mipmap/ic_launcher" />
            
        <!-- Notification Color -->
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_color"
            android:resource="@android:color/holo_blue_dark" />
    </application>
    <!-- Required to query activities that can process text, see:
         https://developer.android.com/training/package-visibility and
         https://developer.android.com/reference/android/content/Intent#ACTION_PROCESS_TEXT.

         In particular, this is used by the Flutter engine in io.flutter.plugin.text.ProcessTextPlugin. -->
    <queries>
        <intent>
            <action android:name="android.intent.action.PROCESS_TEXT"/>
            <data android:mimeType="text/plain"/>
        </intent>
    </queries>
</manifest>
